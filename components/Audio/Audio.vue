<template>
    <div class="audio" ref="audio" :class="{ '-active': isShowing }" :style="{ '--offset': offset + 'px' }">
        <audio ref="track" :src="source" type="audio/mpeg" preload="metadata" loop />
        <div class="audio-player">
            <div class="audio-player-seek">
                <input
                    ref="seek"
                    :style="{
                        '--current': (slider.current / slider.max) * 100 + '%',
                    }"
                    type="range"
                    :min="slider.min"
                    :max="slider.max"
                    v-model="slider.current"
                />
            </div>

            <div class="audio-player-details">
                <p class="audio-player-track">{{ title }}</p>
                <button class="audio-player-exit" data-cursor="xxs" data-stick @click="close">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path
                            opacity="0.12"
                            d="M10.3029 14.3029L9.09706 13.0971C7.81193 11.8119 7.16936 11.1694 7.12594 10.6177C7.08827 10.139 7.28203 9.67123 7.64715 9.35939C8.06794 9 8.97667 9 10.7941 9H13.2059C15.0233 9 15.9321 9 16.3529 9.35939C16.718 9.67123 16.9117 10.139 16.8741 10.6177C16.8306 11.1694 16.1881 11.8119 14.9029 13.0971L13.6971 14.3029L13.6971 14.3029C13.103 14.897 12.806 15.194 12.4635 15.3053C12.1623 15.4032 11.8377 15.4032 11.5365 15.3053C11.194 15.194 10.897 14.897 10.3029 14.3029Z"
                            fill="#22272F"
                        />
                        <path
                            fill-rule="evenodd"
                            clip-rule="evenodd"
                            d="M10.7558 8.25L10.7941 8.25H13.2059L13.2442 8.25C14.1204 8.24999 14.8291 8.24998 15.3693 8.29785C15.8927 8.34423 16.4369 8.44489 16.8399 8.78909C17.3876 9.25684 17.6782 9.95852 17.6217 10.6765C17.5801 11.2049 17.2665 11.6609 16.9292 12.0638C16.581 12.4796 16.0799 12.9807 15.4603 13.6003L15.4332 13.6274L14.2274 14.8333L14.2069 14.8537C13.9274 15.1333 13.6862 15.3745 13.4713 15.5569C13.2445 15.7494 12.9982 15.9201 12.6953 16.0186C12.2434 16.1654 11.7566 16.1654 11.3047 16.0186C11.0018 15.9201 10.7554 15.7494 10.5286 15.5569C10.3137 15.3745 10.0726 15.1333 9.79303 14.8537L9.77258 14.8333L8.5667 13.6274L8.53961 13.6003C7.92003 12.9807 7.41889 12.4796 7.07076 12.0638C6.73346 11.6609 6.41981 11.2049 6.37823 10.6765C6.32172 9.95852 6.61236 9.25684 7.16003 8.78909C7.56304 8.44489 8.10726 8.34423 8.63065 8.29785C9.17086 8.24998 9.87955 8.24999 10.7558 8.25ZM8.76305 9.792C8.27252 9.83547 8.15199 9.91451 8.1342 9.9297C7.95165 10.0856 7.85476 10.3195 7.8736 10.5588C7.87544 10.5822 7.90478 10.7233 8.2209 11.1009C8.52112 11.4595 8.9743 11.9137 9.62736 12.5667L10.8332 13.7726C11.139 14.0784 11.3368 14.2754 11.4994 14.4134C11.6552 14.5457 11.7286 14.5791 11.7682 14.592C11.9188 14.6409 12.0811 14.6409 12.2317 14.592C12.2713 14.5791 12.3447 14.5457 12.5006 14.4134C12.6631 14.2754 12.8609 14.0784 13.1667 13.7726L14.3726 12.5667C15.0256 11.9137 15.4788 11.4595 15.779 11.1009C16.0952 10.7233 16.1245 10.5822 16.1263 10.5588C16.1452 10.3195 16.0483 10.0856 15.8657 9.9297C15.8479 9.91451 15.7274 9.83547 15.2369 9.792C14.771 9.75072 14.1294 9.75 13.2059 9.75H10.7941C9.87052 9.75 9.22892 9.75072 8.76305 9.792Z"
                            fill="#22272F"
                        />
                    </svg>
                    <span class="visually-hidden">Close audio player</span>
                </button>
            </div>
            <div class="audio-player-controls">
                <div class="audio-player-actions">
                    <button class="audio-player-actions-play" data-cursor="xxs" data-stick @click="playState">
                        <span class="audio-player-icon" v-if="!isPlaying">
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="24"
                                height="24"
                                viewBox="0 0 24 24"
                                fill="none"
                            >
                                <path
                                    opacity="0.12"
                                    d="M2 13.7843V10.2157C2 6.54083 2 4.70341 2.77108 3.64885C3.44352 2.72919 4.4762 2.13991 5.61005 2.02885C6.91021 1.90149 8.49209 2.83624 11.6559 4.70573L14.6755 6.49007C17.7449 8.3038 19.2796 9.21066 19.798 10.3878C20.2504 11.415 20.2504 12.585 19.798 13.6122C19.2796 14.7893 17.7449 15.6962 14.6755 17.5099L11.6559 19.2943L11.6558 19.2943C8.49209 21.1638 6.91021 22.0985 5.61005 21.9712C4.4762 21.8601 3.44352 21.2708 2.77108 20.3512C2 19.2966 2 17.4592 2 13.7843Z"
                                    fill="#22272F"
                                />
                                <path
                                    fill-rule="evenodd"
                                    clip-rule="evenodd"
                                    d="M12.0025 4.03939L12.0374 4.05999L15.057 5.84432L15.0917 5.86479C16.5971 6.75433 17.7722 7.44873 18.6323 8.06946C19.4966 8.69324 20.1432 9.31072 20.4844 10.0855C21.0216 11.3053 21.0216 12.6946 20.4844 13.9144C20.1432 14.6892 19.4966 15.3067 18.6323 15.9304C17.7722 16.5512 16.5971 17.2456 15.0917 18.1351L15.0571 18.1556L12.0374 19.9399L12.0025 19.9605C10.4502 20.8778 9.23965 21.5931 8.25506 22.0593C7.26713 22.5271 6.39423 22.8015 5.53693 22.7175C4.19049 22.5856 2.96418 21.8859 2.16565 20.7938C1.65722 20.0984 1.44939 19.2073 1.34952 18.1188C1.24999 17.034 1.24999 15.6279 1.25 13.8248L1.25 13.7843V10.2156L1.25 10.1751C1.24999 8.37196 1.24999 6.96591 1.34952 5.88108C1.44939 4.79257 1.65722 3.90147 2.16565 3.20612C2.96418 2.11403 4.19049 1.41426 5.53693 1.28237C6.39423 1.19839 7.26713 1.47279 8.25506 1.94057C9.23965 2.40676 10.4502 3.12207 12.0025 4.03939ZM7.61315 3.29627C6.69416 2.86114 6.12603 2.73184 5.68316 2.77522C4.76192 2.86546 3.92286 3.34426 3.3765 4.09148C3.11385 4.45068 2.93615 5.00558 2.84325 6.01813C2.75075 7.02625 2.75 8.36339 2.75 10.2156V13.7843C2.75 15.6365 2.75075 16.9737 2.84325 17.9818C2.93615 18.9943 3.11385 19.5492 3.3765 19.9084C3.92286 20.6556 4.76192 21.1344 5.68316 21.2247C6.12603 21.2681 6.69416 21.1388 7.61315 20.7036C8.52812 20.2704 9.67969 19.5908 11.2743 18.6485L14.294 16.8642C15.8413 15.9498 16.9568 15.2898 17.7544 14.7141C18.5544 14.1368 18.9344 13.7122 19.1116 13.3098C19.4792 12.4752 19.4792 11.5247 19.1116 10.6901C18.9344 10.2877 18.5544 9.86314 17.7544 9.28577C16.9568 8.71009 15.8413 8.05008 14.294 7.13572L11.2743 5.35138C9.67968 4.4091 8.52812 3.7295 7.61315 3.29627Z"
                                    fill="#22272F"
                                />
                            </svg>
                            <span class="visually-hidden">Play audio</span>
                        </span>
                        <span class="audio-player-icon" v-else>
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="24"
                                height="24"
                                viewBox="0 0 24 24"
                                fill="none"
                            >
                                <path
                                    opacity="0.12"
                                    fill-rule="evenodd"
                                    clip-rule="evenodd"
                                    d="M3.21799 4.09202C3 4.51984 3 5.0799 3 6.2V17.8C3 18.9201 3 19.4802 3.21799 19.908C3.40973 20.2843 3.7157 20.5903 4.09202 20.782C4.51984 21 5.0799 21 6.2 21H6.8C7.92011 21 8.48016 21 8.90798 20.782C9.28431 20.5903 9.59027 20.2843 9.78201 19.908C10 19.4802 10 18.9201 10 17.8V6.2C10 5.0799 10 4.51984 9.78201 4.09202C9.59027 3.7157 9.28431 3.40973 8.90798 3.21799C8.48016 3 7.92011 3 6.8 3H6.2C5.0799 3 4.51984 3 4.09202 3.21799C3.7157 3.40973 3.40973 3.7157 3.21799 4.09202ZM14.218 4.09202C14 4.51984 14 5.0799 14 6.2V17.8C14 18.9201 14 19.4802 14.218 19.908C14.4097 20.2843 14.7157 20.5903 15.092 20.782C15.5198 21 16.0799 21 17.2 21H17.8C18.9201 21 19.4802 21 19.908 20.782C20.2843 20.5903 20.5903 20.2843 20.782 19.908C21 19.4802 21 18.9201 21 17.8V6.2C21 5.0799 21 4.51984 20.782 4.09202C20.5903 3.7157 20.2843 3.40973 19.908 3.21799C19.4802 3 18.9201 3 17.8 3H17.2C16.0799 3 15.5198 3 15.092 3.21799C14.7157 3.40973 14.4097 3.7157 14.218 4.09202Z"
                                    fill="#22272F"
                                />
                                <path
                                    fill-rule="evenodd"
                                    clip-rule="evenodd"
                                    d="M6.2 2.25H6.16957H6.16954C5.6354 2.24999 5.18956 2.24998 4.82533 2.27974C4.44545 2.31078 4.08879 2.37789 3.75153 2.54973C3.23408 2.81339 2.81339 3.23408 2.54973 3.75153C2.37789 4.08879 2.31078 4.44545 2.27974 4.82533C2.24998 5.18956 2.24999 5.6354 2.25 6.16954V6.16957V6.2V17.8V17.8304V17.8305C2.24999 18.3646 2.24998 18.8104 2.27974 19.1747C2.31078 19.5546 2.37789 19.9112 2.54973 20.2485C2.81339 20.7659 3.23408 21.1866 3.75153 21.4503C4.08879 21.6221 4.44545 21.6892 4.82533 21.7203C5.18956 21.75 5.6354 21.75 6.16955 21.75H6.2H6.8H6.83045C7.3646 21.75 7.81044 21.75 8.17467 21.7203C8.55456 21.6892 8.91121 21.6221 9.24848 21.4503C9.76592 21.1866 10.1866 20.7659 10.4503 20.2485C10.6221 19.9112 10.6892 19.5546 10.7203 19.1747C10.75 18.8104 10.75 18.3646 10.75 17.8304V17.8V6.2V6.16957C10.75 5.63542 10.75 5.18957 10.7203 4.82533C10.6892 4.44545 10.6221 4.08879 10.4503 3.75153C10.1866 3.23408 9.76592 2.81339 9.24848 2.54973C8.91121 2.37789 8.55456 2.31078 8.17467 2.27974C7.81044 2.24998 7.36461 2.24999 6.83047 2.25H6.83044H6.8H6.2ZM4.43251 3.88624C4.52307 3.8401 4.66036 3.79822 4.94748 3.77476C5.24336 3.75058 5.62757 3.75 6.2 3.75H6.8C7.37243 3.75 7.75664 3.75058 8.05252 3.77476C8.33965 3.79822 8.47693 3.8401 8.56749 3.88624C8.80269 4.00609 8.99392 4.19731 9.11376 4.43251C9.1599 4.52307 9.20179 4.66036 9.22524 4.94748C9.24942 5.24336 9.25 5.62757 9.25 6.2V17.8C9.25 18.3724 9.24942 18.7566 9.22524 19.0525C9.20179 19.3396 9.1599 19.4769 9.11376 19.5675C8.99392 19.8027 8.80269 19.9939 8.56749 20.1138C8.47693 20.1599 8.33965 20.2018 8.05252 20.2252C7.75664 20.2494 7.37243 20.25 6.8 20.25H6.2C5.62757 20.25 5.24336 20.2494 4.94748 20.2252C4.66036 20.2018 4.52307 20.1599 4.43251 20.1138C4.19731 19.9939 4.00609 19.8027 3.88624 19.5675C3.8401 19.4769 3.79822 19.3396 3.77476 19.0525C3.75058 18.7566 3.75 18.3724 3.75 17.8V6.2C3.75 5.62757 3.75058 5.24336 3.77476 4.94748C3.79822 4.66036 3.8401 4.52307 3.88624 4.43251C4.00609 4.19731 4.19731 4.00609 4.43251 3.88624ZM17.2 2.25H17.1696H17.1695C16.6354 2.24999 16.1896 2.24998 15.8253 2.27974C15.4454 2.31078 15.0888 2.37789 14.7515 2.54973C14.2341 2.81339 13.8134 3.23408 13.5497 3.75153C13.3779 4.08879 13.3108 4.44545 13.2797 4.82533C13.25 5.18956 13.25 5.63541 13.25 6.16957V6.2V17.8V17.8304C13.25 18.3646 13.25 18.8104 13.2797 19.1747C13.3108 19.5546 13.3779 19.9112 13.5497 20.2485C13.8134 20.7659 14.2341 21.1866 14.7515 21.4503C15.0888 21.6221 15.4454 21.6892 15.8253 21.7203C16.1896 21.75 16.6354 21.75 17.1695 21.75H17.2H17.8H17.8305C18.3646 21.75 18.8104 21.75 19.1747 21.7203C19.5546 21.6892 19.9112 21.6221 20.2485 21.4503C20.7659 21.1866 21.1866 20.7659 21.4503 20.2485C21.6221 19.9112 21.6892 19.5546 21.7203 19.1747C21.75 18.8104 21.75 18.3646 21.75 17.8304V17.8V6.2V6.16957C21.75 5.63542 21.75 5.18957 21.7203 4.82533C21.6892 4.44545 21.6221 4.08879 21.4503 3.75153C21.1866 3.23408 20.7659 2.81339 20.2485 2.54973C19.9112 2.37789 19.5546 2.31078 19.1747 2.27974C18.8104 2.24998 18.3646 2.24999 17.8305 2.25H17.8304H17.8H17.2ZM15.4325 3.88624C15.5231 3.8401 15.6604 3.79822 15.9475 3.77476C16.2434 3.75058 16.6276 3.75 17.2 3.75H17.8C18.3724 3.75 18.7566 3.75058 19.0525 3.77476C19.3396 3.79822 19.4769 3.8401 19.5675 3.88624C19.8027 4.00609 19.9939 4.19731 20.1138 4.43251C20.1599 4.52307 20.2018 4.66036 20.2252 4.94748C20.2494 5.24336 20.25 5.62757 20.25 6.2V17.8C20.25 18.3724 20.2494 18.7566 20.2252 19.0525C20.2018 19.3396 20.1599 19.4769 20.1138 19.5675C19.9939 19.8027 19.8027 19.9939 19.5675 20.1138C19.4769 20.1599 19.3396 20.2018 19.0525 20.2252C18.7566 20.2494 18.3724 20.25 17.8 20.25H17.2C16.6276 20.25 16.2434 20.2494 15.9475 20.2252C15.6604 20.2018 15.5231 20.1599 15.4325 20.1138C15.1973 19.9939 15.0061 19.8027 14.8862 19.5675C14.8401 19.4769 14.7982 19.3396 14.7748 19.0525C14.7506 18.7566 14.75 18.3724 14.75 17.8V6.2C14.75 5.62757 14.7506 5.24336 14.7748 4.94748C14.7982 4.66036 14.8401 4.52307 14.8862 4.43251C15.0061 4.19731 15.1973 4.00609 15.4325 3.88624Z"
                                    fill="#22272F"
                                />
                            </svg>
                            <span class="visually-hidden">Pause audio</span>
                        </span>
                    </button>
                    <button class="audio-player-actions-reset" data-cursor="xxs" data-stick @click="replay">
                        <span class="audio-player-icon">
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="24"
                                height="24"
                                viewBox="0 0 24 24"
                                fill="none"
                            >
                                <circle opacity="0.12" cx="12" cy="13" r="9" fill="#22272F" />
                                <path
                                    fill-rule="evenodd"
                                    clip-rule="evenodd"
                                    d="M12.4927 0.434534C12.805 0.706636 12.8376 1.18039 12.5655 1.49269L10.9957 3.2944C11.3215 3.26535 11.6563 3.25001 12 3.25001C17.3848 3.25001 21.75 7.61523 21.75 13C21.75 18.3848 17.3848 22.75 12 22.75C6.61522 22.75 2.25 18.3848 2.25 13C2.25 10.9967 2.85496 9.13251 3.89229 7.58282C4.1227 7.2386 4.58853 7.14634 4.93274 7.37675C5.27696 7.60716 5.36922 8.07299 5.13881 8.41721C4.26158 9.72771 3.75 11.303 3.75 13C3.75 17.5564 7.44365 21.25 12 21.25C16.5563 21.25 20.25 17.5564 20.25 13C20.25 8.44366 16.5563 4.75001 12 4.75001C11.5815 4.75001 11.1793 4.77614 10.7932 4.82441L12.9424 6.39439C13.2769 6.63872 13.35 7.10794 13.1056 7.44242C12.8613 7.77689 12.3921 7.84997 12.0576 7.60563L8.55759 5.04888C8.38795 4.92496 8.27806 4.73556 8.25466 4.52678C8.23127 4.318 8.29651 4.10898 8.43452 3.95058L11.4345 0.507328C11.7066 0.195024 12.1804 0.162433 12.4927 0.434534Z"
                                    fill="#22272F"
                                />
                            </svg>
                            <span class="visually-hidden">Replay audio</span>
                        </span>
                    </button>
                    <button class="audio-player-actions-volume" data-cursor="xxs" data-stick @click="toggleVolume">
                        <span class="audio-player-icon" v-if="volume.value > 0">
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="24"
                                height="24"
                                viewBox="0 0 24 24"
                                fill="none"
                            >
                                <path
                                    opacity="0.12"
                                    d="M6.49167 15.9998H6C5.07003 15.9998 4.60504 15.9998 4.22354 15.8975C3.18827 15.6201 2.37962 14.8115 2.10222 13.7762C2 13.3947 2 12.9297 2 11.9998C2 11.0698 2 10.6048 2.10222 10.2233C2.37962 9.18802 3.18827 8.37938 4.22354 8.10198C4.60504 7.99976 5.07003 7.99976 6 7.99976H6.49167C6.91814 7.99976 7.13138 7.99976 7.32906 7.95947C7.71106 7.88161 8.06197 7.6938 8.33865 7.41915C8.48183 7.27702 8.60011 7.0996 8.83667 6.74475C10.0339 4.94896 10.6325 4.05106 11.1114 3.81353C12.0579 3.34419 13.2061 3.69185 13.7332 4.60735C14 5.07067 14 6.14981 14 8.30808V15.6914C14 17.8497 14 18.9288 13.7332 19.3922C13.2061 20.3077 12.0579 20.6553 11.1114 20.186C10.6325 19.9485 10.0339 19.0506 8.83667 17.2548C8.60011 16.8999 8.48183 16.7225 8.33865 16.5804C8.06197 16.3057 7.71106 16.1179 7.32906 16.04C7.13138 15.9998 6.91814 15.9998 6.49167 15.9998Z"
                                    fill="#22272F"
                                />
                                <path
                                    fill-rule="evenodd"
                                    clip-rule="evenodd"
                                    d="M14.3832 4.23347C13.6584 2.97466 12.0796 2.49663 10.7783 3.14198C10.3593 3.34976 9.99525 3.77632 9.64355 4.245C9.27178 4.74043 8.81351 5.42784 8.22707 6.3075L8.21268 6.32909C7.95868 6.71009 7.88712 6.81099 7.81032 6.88724C7.63739 7.0589 7.41807 7.17628 7.17932 7.22494C7.07327 7.24655 6.94963 7.25012 6.49172 7.25012L6.00005 7.25012L5.88425 7.2501C5.06629 7.24983 4.50814 7.24964 4.02948 7.3779C2.73538 7.72465 1.72458 8.73545 1.37783 10.0295C1.24957 10.5082 1.24975 11.0664 1.25002 11.8843L1.25005 12.0001L1.25002 12.1159C1.24975 12.9339 1.24957 13.492 1.37783 13.9707C1.72458 15.2648 2.73538 16.2756 4.02948 16.6223C4.50813 16.7506 5.06627 16.7504 5.88421 16.7501L5.88426 16.7501L6.00005 16.7501L6.49172 16.7501C6.94963 16.7501 7.07327 16.7537 7.17932 16.7753C7.41807 16.824 7.63739 16.9413 7.81032 17.113C7.88712 17.1892 7.95868 17.2901 8.21268 17.6711L8.2271 17.6928C8.81352 18.5724 9.27179 19.2598 9.64355 19.7552C9.99525 20.2239 10.3593 20.6505 10.7783 20.8583C12.0796 21.5036 13.6584 21.0256 14.3832 19.7668C14.6166 19.3615 14.6829 18.8046 14.7155 18.2196C14.7501 17.6011 14.7501 16.775 14.75 15.7178L14.75 15.7178L14.75 15.6918L14.75 8.30844L14.75 8.28249L14.75 8.28245C14.75 7.22526 14.7501 6.39911 14.7155 5.78068C14.6829 5.19562 14.6166 4.63878 14.3832 4.23347ZM11.4447 4.48581C12.0362 4.19247 12.7539 4.40976 13.0833 4.98195C13.1167 5.03996 13.1838 5.25435 13.2179 5.86426C13.2498 6.43574 13.25 7.21983 13.25 8.30844L13.25 15.6918C13.25 16.7804 13.2498 17.5645 13.2179 18.136C13.1838 18.7459 13.1167 18.9603 13.0833 19.0183C12.7539 19.5905 12.0362 19.8078 11.4447 19.5144C11.3847 19.4847 11.21 19.3435 10.8433 18.8549C10.4998 18.3971 10.0646 17.7449 9.46075 16.8391L9.42532 16.7859C9.22347 16.4828 9.06518 16.2451 8.86708 16.0485C8.48665 15.6708 8.00414 15.4126 7.47889 15.3055C7.20538 15.2498 6.91981 15.2499 6.55566 15.2501L6.55564 15.2501L6.49172 15.2501L6.00005 15.2501C5.02179 15.2501 4.67979 15.2437 4.41771 15.1735C3.64125 14.9654 3.03477 14.3589 2.82671 13.5825C2.75649 13.3204 2.75005 12.9784 2.75005 12.0001C2.75005 11.0219 2.75649 10.6799 2.82671 10.4178C3.03477 9.64132 3.64125 9.03484 4.4177 8.82679C4.67979 8.75656 5.02179 8.75012 6.00005 8.75012L6.49172 8.75012L6.55566 8.75014L6.55566 8.75014C6.9198 8.75032 7.20538 8.75047 7.47889 8.69472C8.00414 8.58767 8.48665 8.32943 8.86708 7.95178C9.06517 7.75514 9.22346 7.51744 9.4253 7.21436L9.46075 7.16114C10.0646 6.25536 10.4998 5.60312 10.8433 5.14531C11.21 4.65672 11.3847 4.51556 11.4447 4.48581ZM17.3763 5.5836C17.6064 5.23914 18.0721 5.14637 18.4166 5.37641C20.4359 6.72491 21.75 9.20754 21.75 12.0001C21.75 14.7927 20.4359 17.2753 18.4166 18.6238C18.0721 18.8539 17.6064 18.7611 17.3763 18.4166C17.1463 18.0722 17.2391 17.6064 17.5835 17.3764C19.1511 16.3296 20.25 14.3352 20.25 12.0001C20.25 9.66501 19.1511 7.67064 17.5835 6.62383C17.2391 6.39379 17.1463 5.92807 17.3763 5.5836ZM16.3763 9.5836C16.6064 9.23914 17.0721 9.14638 17.4166 9.37641C18.2402 9.92647 18.75 10.9168 18.75 12.0001C18.75 13.0835 18.2402 14.0738 17.4166 14.6238C17.0721 14.8539 16.6064 14.7611 16.3763 14.4166C16.1463 14.0722 16.2391 13.6064 16.5835 13.3764C16.9555 13.128 17.25 12.626 17.25 12.0001C17.25 11.3742 16.9555 10.8722 16.5835 10.6238C16.2391 10.3938 16.1463 9.92807 16.3763 9.5836Z"
                                    fill="#22272F"
                                />
                            </svg>
                            <span class="visually-hidden">Adjust volume of audio</span>
                        </span>
                        <span class="audio-player-icon" v-else>
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="24"
                                height="24"
                                viewBox="0 0 24 24"
                                fill="none"
                            >
                                <path
                                    opacity="0.12"
                                    d="M6.49167 16.0001H6C5.07003 16.0001 4.60504 16.0001 4.22354 15.8979C3.18827 15.6205 2.37962 14.8118 2.10222 13.7765C2 13.395 2 12.93 2 12.0001C2 11.0701 2 10.6051 2.10222 10.2236C2.37962 9.18834 3.18827 8.3797 4.22354 8.1023C4.60504 8.00008 5.07003 8.00008 6 8.00008H6.49167C6.91814 8.00008 7.13138 8.00008 7.32906 7.95979C7.49306 7.92636 7.65133 7.87267 7.80046 7.80054L14 14.0001V15.6918C14 17.85 14 18.9292 13.7332 19.3925C13.2061 20.308 12.0579 20.6556 11.1114 20.1863C10.6325 19.9488 10.0339 19.0509 8.83667 17.2551C8.60011 16.9002 8.48183 16.7228 8.33865 16.5807C8.06197 16.306 7.71106 16.1182 7.32906 16.0404C7.13138 16.0001 6.91814 16.0001 6.49167 16.0001Z"
                                    fill="#22272F"
                                />
                                <path
                                    fill-rule="evenodd"
                                    clip-rule="evenodd"
                                    d="M3.53038 2.46967C3.23748 2.17678 2.76261 2.17678 2.46972 2.46967C2.17682 2.76256 2.17682 3.23744 2.46972 3.53033L6.18939 7.25L6.00005 7.25L5.88425 7.24998L5.88424 7.24998C5.06628 7.24971 4.50814 7.24952 4.02948 7.37778C2.73538 7.72453 1.72458 8.73533 1.37783 10.0294C1.24957 10.5081 1.24975 11.0662 1.25002 11.8842L1.25005 12L1.25002 12.1158C1.24975 12.9338 1.24957 13.4919 1.37783 13.9706C1.72458 15.2647 2.73538 16.2755 4.02948 16.6222C4.50814 16.7505 5.06629 16.7503 5.88425 16.75L6.00005 16.75L6.49172 16.75C6.94963 16.75 7.07327 16.7536 7.17932 16.7752C7.41807 16.8238 7.63739 16.9412 7.81032 17.1129C7.88712 17.1891 7.95868 17.29 8.21268 17.671L8.22706 17.6926C8.8135 18.5723 9.27178 19.2597 9.64355 19.7551C9.99525 20.2238 10.3593 20.6504 10.7783 20.8581C12.0796 21.5035 13.6584 21.0255 14.3832 19.7666C14.6166 19.3613 14.6829 18.8045 14.7155 18.2194C14.749 17.6193 14.75 16.8234 14.75 15.8107L20.4697 21.5303C20.7626 21.8232 21.2375 21.8232 21.5304 21.5303C21.8233 21.2374 21.8233 20.7626 21.5304 20.4697L14.5304 13.4697L8.33084 7.27013L3.53038 2.46967ZM7.47889 8.6946C7.52126 8.68596 7.56336 8.67634 7.60514 8.66576L13.25 14.3107L13.25 15.6917C13.25 16.7803 13.2498 17.5644 13.2179 18.1359C13.1838 18.7458 13.1167 18.9602 13.0833 19.0182C12.7539 19.5904 12.0362 19.8076 11.4447 19.5143C11.3847 19.4846 11.21 19.3434 10.8433 18.8548C10.4998 18.397 10.0646 17.7448 9.46076 16.839L9.42531 16.7858L9.4253 16.7858C9.22347 16.4827 9.06517 16.245 8.86708 16.0483C8.48665 15.6707 8.00414 15.4125 7.47889 15.3054C7.20538 15.2497 6.9198 15.2498 6.55566 15.25L6.49172 15.25L6.00005 15.25C5.02179 15.25 4.67979 15.2436 4.4177 15.1733C3.64125 14.9653 3.03477 14.3588 2.82671 13.5823C2.75649 13.3203 2.75005 12.9783 2.75005 12C2.75005 11.0217 2.75649 10.6797 2.82671 10.4177C3.03477 9.6412 3.64125 9.03472 4.4177 8.82667C4.67979 8.75644 5.02179 8.75 6.00005 8.75L6.49172 8.75L6.55565 8.75002C6.9198 8.7502 7.20538 8.75035 7.47889 8.6946ZM14.3832 4.23335C13.6584 2.97454 12.0796 2.49651 10.7783 3.14186C10.4569 3.30122 10.1827 3.57888 9.93648 3.8731C9.67948 4.18023 9.39033 4.58409 9.05356 5.07675C8.8198 5.4187 8.90751 5.8854 9.24946 6.11916C9.59142 6.35291 10.0581 6.2652 10.2919 5.92325C10.6257 5.43485 10.8801 5.08282 11.0869 4.83572C11.3044 4.57572 11.4143 4.50079 11.4447 4.48569C12.0362 4.19235 12.7539 4.40964 13.0833 4.98183C13.1167 5.03984 13.1838 5.25423 13.2179 5.86415C13.2498 6.43562 13.25 7.21971 13.25 8.30833L13.25 10C13.25 10.4142 13.5858 10.75 14 10.75C14.4143 10.75 14.75 10.4142 14.75 10L14.75 8.30833L14.75 8.28237L14.75 8.28233C14.75 7.22514 14.7501 6.39899 14.7155 5.78056C14.6829 5.1955 14.6166 4.63866 14.3832 4.23335ZM17.3763 5.58348C17.6064 5.23902 18.0721 5.14625 18.4166 5.37629C20.4358 6.72479 21.75 9.20742 21.75 12C21.75 13.1734 21.5185 14.2891 21.1019 15.2886C20.9409 15.6748 20.7521 16.0439 20.5383 16.3923C20.3216 16.7453 19.8598 16.8559 19.5068 16.6392C19.1537 16.4225 19.0432 15.9607 19.2599 15.6077C19.4326 15.3263 19.5859 15.0267 19.7174 14.7114C20.0575 13.8955 20.25 12.976 20.25 12C20.25 9.66489 19.1511 7.67052 17.5835 6.62371C17.2391 6.39367 17.1463 5.92795 17.3763 5.58348ZM16.3763 9.58348C16.6064 9.23902 17.0721 9.14625 17.4166 9.37629C18.2402 9.92635 18.75 10.9167 18.75 12C18.75 12.457 18.6599 12.8943 18.4955 13.2886C18.3361 13.6709 17.897 13.8516 17.5147 13.6923C17.1323 13.5329 16.9516 13.0937 17.111 12.7114C17.1989 12.5006 17.25 12.2595 17.25 12C17.25 11.3741 16.9555 10.8721 16.5835 10.6237C16.2391 10.3937 16.1463 9.92795 16.3763 9.58348Z"
                                    fill="#22272F"
                                />
                            </svg>
                            <span class="visually-hidden">The audio volume is currently muted</span>
                        </span>
                    </button>
                </div>
                <p class="audio-player-time">
                    <span v-if="hasPlayed">
                        <span class="visually-hidden">Time played: </span>
                        {{ calculateTime(slider.current) }}
                    </span>
                    <span class="audio-player-time-separator" v-if="hasPlayed">/</span>
                    <span class="visually-hidden">of total time: </span> {{ calculateTime(duration) }}
                </p>
            </div>

            <div class="audio-player-volume" v-if="volume.isShowing">
                <input
                    class="audio-player-volume-seek"
                    :style="{
                        '--current': volume.value + '%',
                        '--height': $refs.audio.getBoundingClientRect().height + 'px',
                    }"
                    type="range"
                    min="0"
                    max="100"
                    v-model="volume.value"
                    @change="setVolume"
                />
            </div>
        </div>
    </div>
</template>

<script>
export default {
    name: 'Audio',
    props: {
        source: {
            type: String,
            default() {
                return {
                    url: 'https://www.w3schools.com/html/horse.mp3',
                }
            },
        },
        title: {
            type: String,
            default: 'Listen to this article',
        },
        isShowing: {
            type: Boolean,
            default: false,
        },
    },
    data() {
        return {
            volume: {
                value: 50,
                isShowing: false,
            },
            duration: 0,
            slider: {
                current: 0,
                buffered: 0,
                min: 0,
                max: 0,
            },
            isPlaying: false,
            hasPlayed: false,
            animFrame: null,
            offset: 0,
        }
    },
    computed: {
        currentPlayedTime() {
            return this.slider.current
        },
    },
    methods: {
        calculateTime(time) {
            const minutes = Math.floor(time / 60)
            const seconds = Math.floor(time % 60)
            return `${minutes}:${seconds < 10 ? `0${seconds}` : seconds}`
        },
        playState() {
            this.isPlaying = !this.isPlaying
            if (this.isPlaying) {
                this.hasPlayed = true
                this.$refs.track.currentTime = this.slider.current
                this.$refs.track.play()
                requestAnimationFrame(this.updateTime)
            } else {
                this.$refs.track.pause()
                cancelAnimationFrame(this.animFrame)
            }
        },
        updateTime() {
            const audio = this.$refs.track
            this.slider.current = Math.floor(audio.currentTime)
            this.animFrame = requestAnimationFrame(this.updateTime)
        },
        replay() {
            const playing = this.isPlaying
            this.isPlaying = false
            this.$refs.track.pause()
            this.slider.current = 0
            this.$refs.track.currentTime = 0

            if (playing) {
                this.isPlaying = true
                this.$refs.track.play()
            }
        },
        toggleVolume() {
            this.volume.isShowing = !this.volume.isShowing
        },
        setVolume() {
            this.$refs.track.volume = this.volume.value / 100
        },
        close() {
            this.$refs.track.pause()
            this.isPlaying = false
            this.isShowing = false
        },
        calculateOffset() {
            const screen = window.innerWidth
            const aside = document.querySelector('aside').getBoundingClientRect().left
            this.offset = aside
        },
    },
    mounted() {
        const audio = this.$refs.track
        const seek = this.$refs.seek

        audio.addEventListener('loadedmetadata', () => {
            if (audio.readyState > 0) {
                this.duration = audio.duration
                this.slider.max = Math.floor(audio.duration)
            }
        })

        seek.addEventListener('mousedown', () => {
            this.hasPlayed = true
        })

        seek.addEventListener('input', () => {
            this.hasPlayed = true
            cancelAnimationFrame(this.animFrame)
        })

        seek.addEventListener('change', () => {
            this.hasPlayed = true
            this.$refs.track.currentTime = this.slider.current
            cancelAnimationFrame(this.animFrame)
            if (this.isPlaying) {
                this.animFrame = requestAnimationFrame(this.updateTime)
            }
        })

        window.addEventListener('resize', () => {
            this.calculateOffset()
        })
        this.calculateOffset()
    },
    watch: {
        currentPlayedTime(value) {
            if (value >= Math.floor(this.duration)) {
                this.$refs.track.pause()
                this.isPlaying = false
                cancelAnimationFrame(this.animFrame)
            }
        },
    },
}
</script>

<style lang="scss">
.audio {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 2em;
    width: 100%;
    background: c('base-9');
    transform: translateY(100%);
    transition: transform 0.15s ease-in-out;
    z-index: 20;

    @include mq('tablet') {
        left: var(--offset);
        right: auto;
        max-width: 378px;
        padding: 1.5em;
        border-radius: 0.375em 0.375em 0 0;
    }

    &.-active {
        transform: translateY(0);
    }

    input[type='range'] {
        -webkit-appearance: none;
        width: 100%;
        height: 5px;
        outline: none;
        padding: 0;
        margin: 0;
        border-radius: 0.375em;
        transition: all 0.15s ease-in-out;
        cursor: pointer;

        // Range Handle
        &::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 1em;
            height: 1em;
            border-radius: 50%;
            background: c('primary-base');
            cursor: pointer;
            transition: all 0.15s ease-in-out;
        }
        &::-moz-range-thumb {
            width: 1em;
            height: 1em;
            border: 0;
            border-radius: 50%;
            background: c('primary-base');
            cursor: pointer;
            transition: background 0.15s ease-in-out;
        }
    }

    button {
        --size: 0.8em;
        width: var(--size);
        height: var(--size);
        padding: 0;
        outline: none;

        span {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        svg {
            display: block;
            width: 100%;
            height: 100%;

            > * {
                fill: c('base-1');
            }
        }
    }

    &-player {
        &-details {
            display: grid;
            grid-template-columns: auto 1.25em;
            align-items: baseline;
            grid-gap: 1em;
        }

        &-track {
            @include fs-xxs;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        &-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1em;
        }

        &-actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-gap: 0.8em;

            button {
            }

            &-play {
            }

            &-reset {
            }

            &-volume {
            }
        }

        &-time {
            @include fs-xxs;
            font-variant-numeric: tabular-nums;
            letter-spacing: 0.025em;

            span {
                opacity: 0.5;
            }
        }

        &-volume {
            position: absolute;
            top: -1em;
            right: 0.75em;
            width: 145px;
            height: 2em;
            padding: 0 0.75em;
            background: c('base-9');
            border-radius: 1em;
            box-shadow: 1px 1px 4px #000;

            input[type='range'].audio-player-volume-seek {
                position: absolute;
                top: 50%;
                left: 1em;
                width: calc(100% - 2em);
                transform: translate(0, -50%);
                background: linear-gradient(
                    90deg,
                    c('primary-base') var(--current),
                    rgba(217, 220, 227, 0.25) var(--current)
                );

                &::-webkit-slider-thumb {
                    -webkit-appearance: none;
                    width: 0.75em;
                    height: 0.75em;
                }

                &:hover {
                    &::-webkit-slider-thumb {
                        transform: scale(1.3);
                    }
                }
            }
        }

        &-seek {
            input[type='range'] {
                background: linear-gradient(
                    90deg,
                    c('primary-base') var(--current),
                    rgba(217, 220, 227, 0.25) var(--current)
                );
                margin-bottom: 1em;
                transform: translateY(2px);

                @include mq('tablet') {
                    position: absolute;
                    bottom: 0;
                    left: 0;
                    margin-bottom: 0;
                }

                &:hover {
                    transform: translateY(0);

                    &::-webkit-slider-thumb {
                        transform: scale(1.5);
                        box-shadow: 1px 1px 8px c('base-9');
                    }
                }
            }
        }

        &-exit {
        }
    }
}
</style>
